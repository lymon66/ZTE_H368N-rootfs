<%function setpara(handle,para_name){set_para(handle,para_name,request(para_name));}var FP_ERRORSTR,FP_ERRORPARAM,FP_HANDLE,FP_RESULT,FP_ERRPRE,FP_IDENTITY,FP_INSTNUM;var PARA[5]={"Type","Enable","Username","Password","Right"};var Username=request("Username");unsetenv("IsLogin");if((request("logout")==1)&&(getenv("Clientaddr")==get_remote_addr())){unsetenv("Lastvisit");unsetenv("Clientaddr");unsetenv("weblogin");unsetenv("NowUsingPage");unsetenv("LastLoginToken");}var login_token =request("Frm_Logintoken");var nowloginToken =request("Frm_Logintoken");if(login_token  IS NULL){login_token ="N/A";}else {login_token =getenv(login_token);}var lognumber=getenv("counter");if(lognumber=="N/A")lognumber=0;else lognumber=integer(lognumber);var logtime=getenv("ca_time");var curtime=timestamp();if(((integer(curtime) -integer(logtime)) >60)&&(lognumber==3)){lognumber=0;}var FP_PARANUM=5;if(Username IS NOT NULL &&Username!=""&&(login_token !="N/A"||getenv("weblogin")!="N/A")&&lognumber!=3){unsetenv(login_token);var g_remote_assist_status=getenv("g_remote_assist_status");if(g_remote_assist_status=="y"&&isWANAccess()==1){var uname=request("Username");var pswd=request("Password");FP_HANDLE=create_paralist();get_inst(FP_HANDLE, "OBJ_RMACCESSWEB_ID","");var tuname=get_para(FP_HANDLE,"Username");var tpswd=get_para(FP_HANDLE,"Password");destroy_paralist(FP_HANDLE);if(uname!=tuname||pswd!=tpswd){FP_RESULT=-1;}else {FP_RESULT=0;}}else {FP_HANDLE=create_paralist();for(var i=0;i<FP_PARANUM;i++){setpara(FP_HANDLE,PARA[i]);}FP_RESULT=login(FP_HANDLE, "OBJ_LOGIN_ID");}if(FP_RESULT==0){var login_name =request("Username");var login_pwd =request("Password");setenv("login_name",login_name);setenv("login_pwd",login_pwd);setenv("nowloginToken",nowloginToken);var upload_tag=getenv("Uploading");if(upload_tag!="1"){unsetenv("status");unsetenv("state");unsetenv("type");}var lv=timestamp();var right=0;var IsChanged=0;setenv("Lastvisit",lv);setenv("IsLogin","1");setenv("Clientaddr",get_remote_addr());if(g_remote_assist_status=="y"&&isWANAccess()==1){right=1;}else {FP_HANDLE=create_paralist();for(var i=0;i<FP_PARANUM;i++){setpara(FP_HANDLE,PARA[i]);}FP_INSTNUM=qeury_list_bycond("OBJ_USERINFO_ID","IGD",FP_HANDLE);destroy_paralist(FP_HANDLE);if(FP_INSTNUM!=-1){FP_HANDLE=create_paralist();FP_IDENTITY=query_identity(0);get_inst(FP_HANDLE, "OBJ_USERINFO_ID",FP_IDENTITY);right=2;IsChanged=get_para(FP_HANDLE,"IsChanged");destroy_paralist(FP_HANDLE);}}setenv("Right",right);setenv("IsChanged",IsChanged);}else {FP_ERRORSTR=FP_RESULT;}if(FP_RESULT==0){setenv("TypeValue",1);setenv("ObjWancId","OBJ_DSLWANC_ID");if(get_config("IsMulti")=="Y"){var HANDLE=create_paralist();get_inst(HANDLE, "OBJ_WANTYPEAUTO_ID","");var WandType=get_para(HANDLE,"WandType");if(WandType==1){setenv("TypeValue",1);}else if(WandType==2){setenv("TypeValue",2);}else if(WandType==15){setenv("TypeValue",0);}else {setenv("TypeValue",1);}setenv("ObjWancId","OBJ_CURWANC_ID");destroy_paralist(HANDLE);}var IPv6_HANDLE=create_paralist();get_inst(IPv6_HANDLE, "OBJ_DEVIPV6ENA_ID","");var IPv6_Enable=get_para(IPv6_HANDLE,"IsEnable");var IPV6SETFROM=get_para(IPv6_HANDLE,"IPV6SETFROM");destroy_paralist(IPv6_HANDLE);setenv("IPv6_Enable",IPv6_Enable);setenv("IPV6SETFROM",IPV6SETFROM);}}%>