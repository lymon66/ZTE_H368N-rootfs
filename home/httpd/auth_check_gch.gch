<%var value=getenv("gw_timeout");var idle=integer(value);if(idle IS NULL ||idle==0)idle=300;else idle*=60;var is_login =1;var ca=getenv("Clientaddr");var ct=timestamp();setenv("Lastvisit",ct);if(ca=="N/A"){is_login =0;}else if(ca!=get_remote_addr())is_login =0;if(get_config("pwdcheck")=="Y"){var login_name, login_pwd, login_right, now_pwd,now_right;var CK_ERRORSTR,CK_ERRORPARAM,CK_HANDLE,CK_IDENTITY,CK_INSTNUM;login_name =getenv("login_name");var g_remote_assist_status=getenv("g_remote_assist_status");if(g_remote_assist_status=="y"&&isWANAccess()==1){}else {CK_HANDLE=create_paralist();set_para(CK_HANDLE,"Username",login_name);CK_INSTNUM=qeury_list_bycond("OBJ_USERINFO_ID","IGD",CK_HANDLE);destroy_paralist(CK_HANDLE);if(1==is_login&&"N/A"!=login_name){if(CK_INSTNUM!=-1){CK_HANDLE=create_paralist();CK_IDENTITY=query_identity(0);get_inst(CK_HANDLE, "OBJ_USERINFO_ID",CK_IDENTITY);now_pwd=get_para(CK_HANDLE,"Password");now_pwd=delMoreSlash(now_pwd);now_right=2;login_pwd =getenv("login_pwd");login_right =getenv("Right");destroy_paralist(CK_HANDLE);if(login_pwd !=now_pwd||login_right !=now_right){is_login =0;}}else {is_login =0;}}}}if(get_config("pm_ech")=="Y"){if(getenv("elogin")==1){is_login =0;}}%>